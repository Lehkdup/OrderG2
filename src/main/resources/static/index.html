<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Books Search</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<form id="book-search-form">
    <div class="input-group mb-3">
        <input type="text" id="search" name="query" class="form-control" placeholder="Search for books">
        <button class="btn btn-primary" type="submit">Search</button>
    </div>
</form>
<div id="results">
    <!-- Ergebnisse werden hier eingefÃ¼gt -->
</div>
<script>
    document.getElementById('book-search-form').addEventListener('submit', function (event) {
        event.preventDefault(); // Verhindert das Standard-Absenden des Formulars

        const query = document.getElementById('search').value;
        if (query.length == 0) {
            fetch(`http://localhost:8080/books`)
                .then(response => response.json()) // Erwartet JSON-Daten
                .then(data => {
                    const resultsDiv = document.getElementById('results');
                    resultsDiv.innerHTML = ''; // Alte Ergebnisse entfernen

                    if (data.length === 0) {
                        resultsDiv.innerHTML = '<p>No results found.</p>';
                    } else {
                        const table = document.createElement('table');
                        table.className = 'table table-bordered';
                        table.innerHTML = `
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Author</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.map(book => `
                            <tr>
                                <td>${book.title}</td>
                                <td>${book.author}</td>
                                <td>${book.description}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                `;
                        resultsDiv.appendChild(table);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('results').innerHTML = '<p>An error occurred while fetching the results.</p>';
                });
        } else {
          fetch(`http://localhost:8080/books/search/${query}`)
                  .then(response => response.json()) // Erwartet JSON-Daten
                  .then(data => {
                    const resultsDiv = document.getElementById('results');
                    resultsDiv.innerHTML = ''; // Alte Ergebnisse entfernen

                    if (data.length === 0) {
                      resultsDiv.innerHTML = '<p>No results found.</p>';
                    } else {
                      const table = document.createElement('table');
                      table.className = 'table table-bordered';
                      table.innerHTML = `
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Author</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.map(book => `
                            <tr>
                                <td>${book.title}</td>
                                <td>${book.author}</td>
                                <td>${book.description}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                `;
                      resultsDiv.appendChild(table);
                    }
                  })
                  .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('results').innerHTML = '<p>An error occurred while fetching the results.</p>';
                  });
        }

    });
</script>
</body>
</html>